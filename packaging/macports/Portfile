# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           cargo 1.0
PortGroup           github 1.0

github.setup        hyperpolymath bunsenite 1.0.0 v
revision            0
categories          devel
license             MIT Palimpsest-0.8
maintainers         {github.com:hyperpolymath @maintainer} openmaintainer
description         Nickel configuration file parser with FFI bindings
long_description    Bunsenite is a Nickel configuration file parser with \
                    multi-language FFI bindings. It provides a Rust core \
                    library with a stable C ABI layer (via Zig) that enables \
                    bindings for Deno, Rescript, and WebAssembly.

homepage            https://github.com/hyperpolymath/bunsenite

checksums           rmd160  SKIP \
                    sha256  SKIP \
                    size    SKIP

# Rust version requirement
compiler.cxx_standard 2017

depends_build-append \
                    port:zig

cargo.crates        {
    # Cargo.lock dependencies will be auto-generated
}

build.args-append   --features=full

destroot {
    xinstall -m 755 ${worksrcpath}/target/[cargo.rust_platform]/release/bunsenite \
        ${destroot}${prefix}/bin/bunsenite

    xinstall -d ${destroot}${prefix}/lib
    xinstall -m 644 ${worksrcpath}/zig/zig-out/lib/libbunsenite.dylib \
        ${destroot}${prefix}/lib/libbunsenite.dylib

    xinstall -d ${destroot}${prefix}/share/doc/${name}
    xinstall -m 644 ${worksrcpath}/README.adoc \
        ${destroot}${prefix}/share/doc/${name}/README.adoc
}

notes "
Bunsenite has been installed with the following components:
- bunsenite CLI at ${prefix}/bin/bunsenite
- libbunsenite.dylib at ${prefix}/lib/libbunsenite.dylib

RSR Compliance: Bronze Tier | TPCF Perimeter: 3
"
